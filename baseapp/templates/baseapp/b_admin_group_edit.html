<!DOCTYPE html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Demo</title>
    {% include 'others/header_static.html' %}
    {% include 'others/favicon.html' %}

    {% load static from staticfiles %}
    <script src="{% static 'js/navbar.js' %}"></script>
    <script src="{% static 'js/nav_badge.js' %}"></script>
    <script src="{% static 'js/a_selected.js' %}"></script>

    <link rel="stylesheet" href="{% static 'cropper/cropper.min.css' %}">
    <script src="{% static 'cropper/cropper.min.js' %}"></script>

    <script src="{% static 'js/nav_badge_populate.js' %}"></script>
    <link href="https://fonts.googleapis.com/css?family=Tauri" rel="stylesheet">
    {% if user.is_authenticated %}
    {% else %}
    {% endif %}
</head>
<body class="light_background_color height_100">
<!--navbar start-->
{% include 'baseapp/_navbar.html' %}

<!--navbar end-->
<!--page info-->
{% include 'others/bootstrap_tester.html' %}

<div class="hidden" id="page_kind">home</div>

{% if user.is_authenticated %}
    <div class="hidden" id="user_id">{{ user.username }}</div>
{% else %}
    <div class="hidden" id="user_id"></div>
{% endif %}
<div class="hidden" id="id">{{ id }}</div>
<!--page info end -->

<div class="container-fluid margin_top_50">
    <div class="row">
        <div class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4">
            <div class="row">
                <a href="{% url 'baseapp:b_admin' %}"><div class="h4">Back To List</div></a>
                <div><h4>Group Edit</h4></div>
                <div>{{ id }}</div>
                <div align="center">
                    <img class="img_300_300" id="img_300" src="">
                </div>
                <div align="center">
                        <span id="span_change_photo">Add</span><br>
                        <span id="span_base_reset">BaseReset(unable)</span>
                </div>
                <div style="background-color: #8e97ed"><h4>Default Edit</h4></div>
                <div class="h4">default name</div>
                <div class="h5" id="default_name"></div>
                <div>name: <input id="default_name_input"></div>
                <div class="h4">default description</div>
                <div class="h5" id="default_desc"></div>
                <div>desc: <input id="default_desc_input"></div>
                <a href=""><div style="background-color: silver" id="default_register">register</div></a>
                <div class="h4" style="background-color: #8e97ed">main_name</div>
                <div class="h5" id="main_name"></div>

                <div>main name: <input id="main_name_input"></div>
                <a href=""><div style="background-color: silver" id="main_name_register">main name register</div></a>
                <div class="h4" style="background-color: #8e97ed">names list</div>
                <div id="name_list"></div>
                <div>name: <input id="name_input"></div>
                <a href=""><div style="background-color: silver" id="name_register">name register</div></a>
                <div>delete name: <input id="name_delete_input"></div>
                    <!-- delete name 은 직접입력해서 지우는 걸로 하자 간단하게 하고 name등록시에 strip 걸어주는 것 잊지마.-->
                <a href=""><div style="background-color: silver" id="name_delete">name delete</div></a>

                <div>photo to main name: <input id="photo_main_input"></div>
                    <!-- delete name 은 직접입력해서 지우는 걸로 하자 간단하게 하고 name등록시에 strip 걸어주는 것 잊지마.-->
                <a href=""><div style="background-color: silver" id="photo_main_register">photo main register</div></a>

                <div>photo delete: <input id="photo_delete_input"></div>
                    <!-- delete name 은 직접입력해서 지우는 걸로 하자 간단하게 하고 name등록시에 strip 걸어주는 것 잊지마.-->
                <a href=""><div style="background-color: silver" id="photo_delete">photo delete</div></a>

                <div class="h4" style="background-color: #8e97ed">photos list</div>
                <div id="photo_list"></div>
                <div class="h4" style="background-color: #8e97ed">member(solo) list</div>
                <div id="member_list"></div>
            </div>
        </div>
    </div>
</div>


<!-- MODAL TO CROP THE IMAGE -->
<div class="modal fade" id="modal_crop" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Crop the photo</h4>
            </div>
            <div class="modal-body padding_0">
                <img src="" id="img_crop" class="max_width_100p">
            </div>
            <div class="modal-footer">
                <div class="btn-group pull-left" role="group">
                    <button type="button" class="btn btn-default js-zoom-in">
                        <span class="glyphicon glyphicon-zoom-in"></span>
                    </button>
                    <button type="button" class="btn btn-default js-zoom-out">
                        <span class="glyphicon glyphicon-zoom-out"></span>
                    </button>
                </div>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary js-crop-and-upload">Save</button>
            </div>
        </div>
    </div>
</div>
<img src="" id="img_chat_hidden" class="max_width_100p hidden">


<form class="hidden" method="post" enctype="multipart/form-data" id="form_upload">
    <input type="file" name="file" id="input_file" accept="image/jpeg, image/png" required>
</form>

</body>
<script>
    $(function () {
        $('#default_register').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/default/register/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    name: $('#default_name_input').val(),
                    desc: $('#default_desc_input').val(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    }
                }
            });
        })
        $('#photo_main_register').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/main/photo/register/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    photo_id: $('#photo_main_input').val(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    }
                }
            });
        })
        $('#photo_delete').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/photo/delete/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    photo_id: $('#photo_delete_input').val(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    }
                }
            });
        })
        $('#name_delete').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/name/delete/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    name: $('#name_delete_input').val(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    }
                }
            });
        })

        $('#name_register').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/name/register/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    name: $('#name_input').val(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    }
                }
            });
        })
        $.ajax({
            url: '/re/b/admin/group/edit/',
            type: 'post',
            dataType: 'json',
            cache: false,
            data: {
                id: $('#id').html(),
            },
            success: function (data) {
                if (data.res === 1) {
                    $('#default_name').html(data.default_name)
                    $('#default_desc').html(data.default_desc)
                    $('#main_name').html(data.main_name)
                    $('#img_300').attr('src', data.main_photo)
                    $.each(data.name_output, function (key, value) {
                        $('#name_list').append('<div class="h5">'+value.name+'</div>')
                    })
                    $.each(data.photo_output, function (key, value) {
                        $('#photo_list').append('<div><img class="img_300_300" src="'+value.photo+'"></div><div>'+value.id+'</div>')
                    })

                    $.each(data.member_solo_output, function (key, value) {
                        $('#member_list').append('<div class="h4">'+value.name+'</div><div class="h5">'+value.id+'</div>')
                    })
                    console.log(data)
                    //location.reload()
                }
            }
        });
        $('#main_name_register').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/b/admin/group/edit/main/name/',
                type: 'post',
                dataType: 'json',
                cache: false,
                data: {
                    id: $('#id').html(),
                    main_name: $('#main_name_input').val()
                },
                success: function (data) {
                    if (data.res === 1) {
                        location.reload()
                    } else {
                        alert('failed')
                    }
                }
            });
        })

        $('#span_change_photo').click(function (e) {
            e.preventDefault();
            $('#input_file').click()
        });
        $('#input_file').change(function () {
            if (this.files && this.files[0]) {
                if (this.files[0].size > (1048576 * 10)) {
                    var agent = navigator.userAgent.toLowerCase();

                    if ((navigator.appName == 'Netscape' && navigator.userAgent.search('Trident') != -1) || (agent.indexOf("msie") != -1)) {
                        // ie 일때 input[type=file] init.
                        $('#input_file').replaceWith($('#input_file').clone(true));
                    } else {
                        //other browser 일때 input[type=file] init.
                        $('#input_file').val("");
                    }
                    alert('File size can\'t exceed 10m');
                    return;
                }
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#img_crop").attr("src", e.target.result);
                    $("#modal_crop").modal("show");
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        /* SCRIPTS TO HANDLE THE CROPPER BOX */
        var image;
        var cropper;
        $("#modal_crop").on("shown.bs.modal", function () {
            image = document.getElementById('img_crop');
            cropper = new Cropper(image, {
                viewMode: 2,
                minCropBoxWidth: 300,
                minCropBoxHeight: 300,
                aspectRatio: 1 / 1,
            });

        }).on("hidden.bs.modal", function () {
            cropper.destroy();
            var agent = navigator.userAgent.toLowerCase();

            if ((navigator.appName == 'Netscape' && navigator.userAgent.search('Trident') != -1) || (agent.indexOf("msie") != -1)) {
                // ie 일때 input[type=file] init.
                $('#input_file').replaceWith($('#input_file').clone(true));
            } else {
                //other browser 일때 input[type=file] init.
                $('#input_file').val("");
            }
        });

        $(".js-zoom-in").click(function () {
            cropper.zoom(0.1);
        });

        $(".js-zoom-out").click(function () {
            cropper.zoom(-0.1);

        });

        $(".js-crop-and-upload").click(function () {
            var cropData = cropper.getData();

            var form_file = $('#form_upload')[0];
            var form_data = new FormData(form_file);
            form_data.append('x', cropData["x"]);
            form_data.append('y', cropData["y"]);
            form_data.append('height', cropData["height"]);
            form_data.append('width', cropData["width"]);
            form_data.append('rotate', cropData["rotate"]);
            form_data.append('id', $('#id').html())

            $.ajax({
                url: '/re/b/admin/group/upload/photo/',
                type: 'post',
                dataType: 'json',
                cache: false,
                processData: false,
                contentType: false,
                data: form_data,
                success: function (data) {
                    console.log(data)
                    $("#modal_crop").modal("hide");
                    if (data.res === 1) {
                        location.reload()

                    }
                }
            });
        });
    })
</script>

</html>