<!DOCTYPE html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Demo</title>
    {% include 'others/header_static.html' %}
    {% include 'others/favicon.html' %}

    {% load static from staticfiles %}
    <script src="{% static 'js/navbar.js' %}"></script>
    <script src="{% static 'js/a_selected.js' %}"></script>
    <script src="{% static 'js/nav_badge.js' %}"></script>
    <script src="{% static 'js/post_populate.js' %}"></script>
    <script src="{% static 'js/follower_following.js' %}"></script>
    <script src="{% static 'js/date_differ.js' %}"></script>
    <link href="https://fonts.googleapis.com/css?family=Tauri" rel="stylesheet">
    {% if user.is_authenticated %}
    {% else %}
    {% endif %}

    <style>
    </style>


</head>
<body class="light_background_color height_100">
<!--navbar start-->
{% include 'baseapp/_navbar.html' %}

<!--navbar end-->
<!--page info-->
{% include 'others/bootstrap_tester.html' %}
<div class="hidden" id="page_kind">user</div>

<div class="hidden" id="chosen_user_id">{{ chosen_user.username }}</div>
{% if user.is_authenticated %}
    <div class="hidden" id="user_id">{{ user.username }}</div>
{% else %}
    <div class="hidden" id="user_id"></div>
{% endif %}
<div class="hidden" id="last_post_id"></div>
<div class="hidden" id="delete_post_id"></div>

<!--page info end -->

<div class="container-fluid margin_top_50">
    <div class="row">
        <div class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4">
            <div class="row" id="content">
                <div class="row div_base" id="chat_base">
                    <div align="center">
                        <img class="img_300_300" id="img_300"
                             src="{{ chosen_user.userphoto.file_300_url }}">
                    </div>

                    <div align="center"><span>{{ chosen_user.usertextname.name }}</span></div>
                    <div align="center"><span>{{ chosen_user.userusername.username }}</span></div>

                    <div class="row">
                        <div class="col-xs-6" align="right"><span>following: </span>
                            <a href="#"><span id="count_following">{{ chosen_user.followingcount.count }}</span></a>
                        </div>
                        <div class="col-xs-6" align="left"><span>followers: </span>
                            <a href="#"><span id="count_follower">{{ chosen_user.followercount.count }}</span></a>
                        </div>
                    </div>

                    {% if following == None %}
                        <a href="">
                            <div class="hidden" align="center" id="follow">
                                <span class="clickable" id="follow_text">follow</span>
                            </div>
                        </a>
                    {% else %}
                        <a href="">
                            <div class="hidden" align="center" id="follow">
                                <span class="clickable" id="follow_text">following <span
                                        class="glyphicon glyphicon-ok"></span></span>
                            </div>
                        </a>
                    {% endif %}

                </div>
                <div id="user_profile_post_list"></div>
                <a href="">
                    <div class="user_profile_more_load hidden" id="more_load" align="center">more load</div>
                </a>
            </div>
        </div>
    </div>
</div>

{% include 'baseapp/_modal_post_delete.html' %}
{% include 'baseapp/_modal_populate.html' %}
{% include 'baseapp/_modal_follow.html' %}

<!-- Hidden 으로 데이터 저장해놓고 modal on show 랑 hide 에서 그 데이터 불러와서 모달 채우게 하자. 그리고 임플린은 친구 중심이고
피드가 존재하게 되었기 때문에 팔로우가 부가적으로 존재하는 것 뿐이다. -->


</body>
<script>
    $(function () {

        $('#post_delete').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/profile/post/delete/', type: 'post', dataType: 'json', cache: false,
                data: {
                    post_id: $('#delete_post_id').html(),
                },
                success: function (data) {
                    if (data.res === 1) {
                        $('#post_wrapper_with_modi_' + $('#delete_post_id').html()).replaceWith('<div>post removed</div>')
                        $('#modal_post_delete').modal('hide')
                    }
                }
            })

        })

        $("#modal_post_delete").on("shown.bs.modal", function () {

        }).on("hidden.bs.modal", function () {
            $('#delete_post_id').html('')
        })
    });
    $(function () {

        $.ajax({
            url: '/re/profile/post/', type: 'post', dataType: 'json', cache: false,
            data: {
                chosen_user_id: $('#chosen_user_id').html(),
                last_post_id: $('#last_post_id').html()
            },
            success: function (data) {
                var _modifier = ''
                var chosen_user_id = $('#chosen_user_id').html()
                var user_id = $('#user_id').html()
                $.each(data.output, function (key, value) {

                    if (chosen_user_id === user_id) {
                        _modifier = '<div align="right"><a href="/update/' + value.obj_type + '/post/' + value.id + '/"><span class="user_profile_post_update">update</span></a><span>  </span><a href=""><span class="user_profile_post_delete">delete</span></a></div>'
                    }
                    var appender = '<div id="post_wrapper_with_modi_' + value.id + '">' +
                        '<div class="row div_base" id="post_wrapper_' + value.id + '">' +
                        '<script defer>' +
                        '    post_populate("' + value.id + '", "' + value.obj_type + '")' +
                        '<' + '/script>' +
                        '</div>' + _modifier +
                        '</div>'
                    var jq_appender = $(appender)
                    jq_appender.find('.user_profile_post_delete').on('click', function (e) {
                        e.preventDefault()
                        $('#delete_post_id').html(value.id)
                        $('#modal_post_delete').modal('show')
                    })
                    $('#user_profile_post_list').append(jq_appender)
                })
                if (data.last === null) {
                    $('#more_load').addClass('hidden')
                    $('#last_post_id').html('')

                } else {
                    $('#more_load').removeClass('hidden')
                    $('#last_post_id').html(data.last)
                }

            }
        })

        $('#more_load').click(function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/profile/post/', type: 'post', dataType: 'json', cache: false,
                data: {
                    chosen_user_id: $('#chosen_user_id').html(),
                    last_post_id: $('#last_post_id').html()
                },
                success: function (data) {
                    var _modifier = ''
                    var chosen_user_id = $('#chosen_user_id').html()
                    var user_id = $('#user_id').html()
                    $.each(data.output, function (key, value) {

                        if (chosen_user_id === user_id) {
                            _modifier = '<div align="right"><a href="/update/' + value.obj_type + '/post/' + value.id + '/"><span class="user_profile_post_update">update</span></a><span>  </span><a href=""><span class="user_profile_post_delete">delete</span></a></div>'
                        }
                        var appender = '<div id="post_wrapper_with_modi_' + value.id + '">' +
                            '<div class="row div_base" id="post_wrapper_' + value.id + '">' +
                            '<script defer>' +
                            '    post_populate("' + value.id + '", "' + value.obj_type + '")' +
                            '<' + '/script>' +
                            '</div>' + _modifier +
                            '</div>'
                        var jq_appender = $(appender)
                        jq_appender.find('.user_profile_post_delete').on('click', function (e) {
                            e.preventDefault()
                            $('#delete_post_id').html(value.id)
                            $('#modal_post_delete').modal('show')
                        })
                        $('#user_profile_post_list').append(jq_appender)
                    })
                    if (data.last === null) {
                        $('#more_load').addClass('hidden')
                        $('#last_post_id').html('')
                    } else {
                        $('#more_load').removeClass('hidden')
                        $('#last_post_id').html(data.last)

                    }

                }
            })

        })
    })

</script>

</html>